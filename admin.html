<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚öôÔ∏è Admin - One Piece Bounty System</title>
  <link rel="stylesheet" href="css/admin.css">
  <link rel="stylesheet" href="css/admin-enhanced.css">
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>‚öì ADMIN</h2>
        <p>One Piece System</p>
      </div>
      <nav class="sidebar-nav">
        <button class="nav-item active" data-tab="pirates">
          <span class="nav-icon">üè¥‚Äç‚ò†Ô∏è</span>
          <span class="nav-text">Qu·∫£n l√Ω H·∫£i T·∫∑c</span>
        </button>
        <button class="nav-item" data-tab="crews">
          <span class="nav-icon">‚öîÔ∏è</span>
          <span class="nav-text">Qu·∫£n l√Ω BƒÉng Nh√≥m</span>
        </button>
        <button class="nav-item" data-tab="ranks">
          <span class="nav-icon">üèÜ</span>
          <span class="nav-text">Qu·∫£n l√Ω C·∫•p ƒê·ªô</span>
        </button>
        <button class="nav-item" data-tab="accounts">
          <span class="nav-icon">üë•</span>
          <span class="nav-text">Qu·∫£n l√Ω T√†i Kho·∫£n</span>
        </button>
        <button class="nav-item" data-tab="quests">
          <span class="nav-icon">üìù</span>
          <span class="nav-text">Qu·∫£n l√Ω Nhi·ªám V·ª•</span>
        </button>
        <button class="nav-item" data-tab="submissions">
          <span class="nav-icon">üì∏</span>
          <span class="nav-text">Duy·ªát B√†i N·ªôp</span>
        </button>
        <button class="nav-item" data-tab="rewards">
          <span class="nav-icon">üéÅ</span>
          <span class="nav-text">Qu·∫£n l√Ω Ph·∫ßn Th∆∞·ªüng</span>
        </button>
        <button class="nav-item" data-tab="weapons">
          <span class="nav-icon">‚öîÔ∏è</span>
          <span class="nav-text">Qu·∫£n l√Ω V≈© Kh√≠</span>
        </button>
      </nav>
      <div class="sidebar-footer">
        <a href="index.html" class="back-btn">
          <span>üîô</span> Quay l·∫°i trang ch√≠nh
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="admin-header">
        <h1 id="pageTitle">üè¥‚Äç‚ò†Ô∏è Qu·∫£n l√Ω H·∫£i T·∫∑c</h1>
        <div class="header-actions">
          <button class="action-btn export" onclick="exportData()">
            <span>üì§</span> Xu·∫•t d·ªØ li·ªáu
          </button>
          <button class="action-btn import" onclick="document.getElementById('importFile').click()">
            <span>üì•</span> Nh·∫≠p d·ªØ li·ªáu
          </button>
          <button class="action-btn sync" onclick="syncToCloud()" title="ƒê·ªìng b·ªô l√™n Firebase">
            <span>‚òÅÔ∏è</span> Sync Cloud
          </button>
          <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>
      </header>

      <!-- Tab Content: Pirates -->
      <section id="pirates-tab" class="tab-content active">
        <div class="tab-header">
          <div class="search-box">
            <input type="text" id="pirateSearch" placeholder="üîç T√¨m ki·∫øm h·∫£i t·∫∑c..." oninput="searchPirates(this.value)">
          </div>
          <div class="bulk-actions" id="bulkActions" style="display: none;">
            <button class="action-btn delete" onclick="deleteSelectedPirates()">
              <span>üóëÔ∏è</span> X√≥a ƒë√£ ch·ªçn (<span id="selectedCount">0</span>)
            </button>
          </div>
          <button class="action-btn danger" onclick="deleteAllPirates()" style="margin-left: 10px;">
            <span>üóëÔ∏è</span> X√≥a T·∫•t C·∫£
          </button>
          <button class="add-btn" onclick="openAddPirateModal()">
            <span>‚ûï</span> Th√™m H·∫£i T·∫∑c
          </button>
        </div>
        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-icon">üè¥‚Äç‚ò†Ô∏è</span>
            <div class="stat-info">
              <span class="stat-value" id="totalPirates">0</span>
              <span class="stat-label">T·ªïng H·∫£i T·∫∑c</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üí∞</span>
            <div class="stat-info">
              <span class="stat-value" id="totalBounty">0‡∏ø</span>
              <span class="stat-label">T·ªïng Bounty</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üëë</span>
            <div class="stat-info">
              <span class="stat-value" id="topRank">-</span>
              <span class="stat-label">C·∫•p Cao Nh·∫•t</span>
            </div>
          </div>
        </div>
        <div class="table-container">
          <table class="data-table" id="piratesTable">
            <thead>
              <tr>
                <th><input type="checkbox" id="selectAllPirates" onchange="toggleSelectAllPirates(this.checked)"></th>
                <th>STT</th>
                <th>Avatar</th>
                <th>T√™n</th>
                <th>BƒÉng Nh√≥m</th>
                <th>Bounty</th>
                <th>C·∫•p ƒê·ªô</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody id="piratesTableBody">
              <!-- Data will be loaded here -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Tab Content: Crews -->
      <section id="crews-tab" class="tab-content">
        <div class="tab-header">
          <div class="search-box">
            <input type="text" id="crewSearch" placeholder="üîç T√¨m ki·∫øm bƒÉng nh√≥m..." oninput="searchCrews(this.value)">
          </div>
          <button class="add-btn" onclick="openAddCrewModal()">
            <span>‚ûï</span> Th√™m BƒÉng Nh√≥m
          </button>
        </div>
        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-icon">‚öîÔ∏è</span>
            <div class="stat-info">
              <span class="stat-value" id="totalCrews">0</span>
              <span class="stat-label">T·ªïng BƒÉng Nh√≥m</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üë•</span>
            <div class="stat-info">
              <span class="stat-value" id="avgMembers">0</span>
              <span class="stat-label">TB Th√†nh Vi√™n</span>
            </div>
          </div>
        </div>
        <div class="crews-grid" id="crewsGrid">
          <!-- Crews will be loaded here -->
        </div>
      </section>

      <!-- Tab Content: Ranks -->
      <section id="ranks-tab" class="tab-content">
        <div class="tab-header">
          <h3>‚öôÔ∏è C·∫•u h√¨nh c√°c c·∫•p ƒë·ªô bounty</h3>
          <button class="add-btn" onclick="openAddRankModal()">
            <span>‚ûï</span> Th√™m C·∫•p ƒê·ªô
          </button>
        </div>
        <div class="ranks-list" id="ranksList">
          <!-- Ranks will be loaded here -->
        </div>
      </section>

      <!-- Tab Content: Accounts -->
      <section id="accounts-tab" class="tab-content">
        <div class="tab-header">
          <div class="search-box">
            <input type="text" id="accountSearch" placeholder="üîç T√¨m ki·∫øm t√†i kho·∫£n..." oninput="searchAccounts(this.value)">
          </div>
          <button class="add-btn" onclick="openAddAccountModal()">
            <span>‚ûï</span> Th√™m T√†i Kho·∫£n
          </button>
        </div>
        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-icon">üë•</span>
            <div class="stat-info">
              <span class="stat-value" id="totalAccounts">0</span>
              <span class="stat-label">T·ªïng T√†i Kho·∫£n</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üëë</span>
            <div class="stat-info">
              <span class="stat-value" id="adminAccounts">0</span>
              <span class="stat-label">Admin</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üë§</span>
            <div class="stat-info">
              <span class="stat-value" id="userAccounts">0</span>
              <span class="stat-label">User</span>
            </div>
          </div>
        </div>
        <div class="table-container">
          <table class="data-table" id="accountsTable">
            <thead>
              <tr>
                <th>STT</th>
                <th>Username</th>
                <th>Email</th>
                <th>üè¥‚Äç‚ò†Ô∏è H·∫£i T·∫∑c</th>
                <th>Vai tr√≤</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Ng√†y t·∫°o</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody id="accountsTableBody">
              <!-- Data will be loaded here -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Tab Content: Quests -->
      <section id="quests-tab" class="tab-content">
        <div class="tab-header">
          <div class="search-box">
            <input type="text" id="questSearch" placeholder="üîç T√¨m ki·∫øm nhi·ªám v·ª•..." oninput="searchQuests(this.value)">
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="add-btn" onclick="openAddQuizQuestModal()">
              <span>üìù</span> Th√™m Nhi·ªám V·ª• Tr·∫Øc Nghi·ªám
            </button>
            <button class="add-btn" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);" onclick="openAddSpecialQuestModal()">
              <span>üì∏</span> Th√™m Nhi·ªám V·ª• ƒê·∫∑c Bi·ªát
            </button>
          </div>
        </div>
        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-icon">üìù</span>
            <div class="stat-info">
              <span class="stat-value" id="totalQuests">0</span>
              <span class="stat-label">T·ªïng Nhi·ªám V·ª•</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üìö</span>
            <div class="stat-info">
              <span class="stat-value" id="totalQuestions">0</span>
              <span class="stat-label">T·ªïng C√¢u H·ªèi</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üéì</span>
            <div class="stat-info">
              <span class="stat-value" id="avgQuestionsPerQuest">0</span>
              <span class="stat-label">TB C√¢u H·ªèi/B·ªô</span>
            </div>
          </div>
        </div>
        
        <!-- Filter by grade and subject -->
        <div class="quest-filters" style="margin: 20px 0; display: flex; gap: 15px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 5px; color: #ecf0f1; font-weight: 600;">üéì Kh·ªëi l·ªõp:</label>
            <select id="gradeFilter" onchange="filterQuests()" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #34495e; background: rgba(52, 73, 94, 0.3); color: white;">
              <option value="">T·∫•t c·∫£</option>
              <option value="3">Kh·ªëi 3</option>
              <option value="4">Kh·ªëi 4</option>
              <option value="5">Kh·ªëi 5</option>
            </select>
          </div>
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 5px; color: #ecf0f1; font-weight: 600;">üìñ M√¥n h·ªçc:</label>
            <select id="subjectFilter" onchange="filterQuests()" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #34495e; background: rgba(52, 73, 94, 0.3); color: white;">
              <option value="">T·∫•t c·∫£</option>
              <option value="tin-hoc">Tin h·ªçc</option>
              <option value="cong-nghe">C√¥ng ngh·ªá</option>
            </select>
          </div>
        </div>
        
        <div class="quests-grid" id="questsGrid">
          <!-- Quests will be loaded here -->
        </div>
      </section>

      <!-- Tab Content: Submissions -->
      <section id="submissions-tab" class="tab-content">
        <div class="tab-header">
          <div class="search-box">
            <input type="text" id="submissionSearch" placeholder="üîç T√¨m ki·∫øm b√†i n·ªôp..." oninput="searchSubmissions(this.value)">
          </div>
          <div style="display: flex; gap: 10px;">
            <select id="submissionStatusFilter" onchange="filterSubmissions()" style="padding: 10px 20px; border-radius: 8px; border: 1px solid #34495e; background: rgba(52, 73, 94, 0.5); color: white; font-weight: 600;">
              <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
              <option value="pending">‚è≥ Ch·ªù duy·ªát</option>
              <option value="approved">‚úÖ ƒê√£ duy·ªát</option>
              <option value="rejected">‚ùå T·ª´ ch·ªëi</option>
            </select>
          </div>
        </div>
        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-icon">üì∏</span>
            <div class="stat-info">
              <span class="stat-value" id="totalSubmissions">0</span>
              <span class="stat-label">T·ªïng B√†i N·ªôp</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">‚è≥</span>
            <div class="stat-info">
              <span class="stat-value" id="pendingSubmissions">0</span>
              <span class="stat-label">Ch·ªù Duy·ªát</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">‚úÖ</span>
            <div class="stat-info">
              <span class="stat-value" id="approvedSubmissions">0</span>
              <span class="stat-label">ƒê√£ Duy·ªát</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">‚ùå</span>
            <div class="stat-info">
              <span class="stat-value" id="rejectedSubmissions">0</span>
              <span class="stat-label">T·ª´ Ch·ªëi</span>
            </div>
          </div>
        </div>
        
        <div class="submissions-grid" id="submissionsGrid">
          <!-- Submissions will be loaded here -->
        </div>
      </section>

      <!-- Tab Content: Rewards -->
      <section id="rewards-tab" class="tab-content" style="display: none;">
        <div class="tab-header">
          <h2>üéÅ Qu·∫£n l√Ω Ph·∫ßn Th∆∞·ªüng</h2>
          <button class="add-btn" onclick="openAddRewardModal()">
            <span>‚ûï</span> Th√™m Ph·∫ßn Th∆∞·ªüng
          </button>
        </div>

        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-icon">üéÅ</span>
            <div class="stat-info">
              <span class="stat-value" id="totalRewards">0</span>
              <span class="stat-label">T·ªïng Ph·∫ßn Th∆∞·ªüng</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üîÑ</span>
            <div class="stat-info">
              <span class="stat-value" id="totalExchanges">0</span>
              <span class="stat-label">L∆∞·ª£t ƒê·ªïi</span>
            </div>
          </div>
          <div class="stat-card">
            <span class="stat-icon">üíé</span>
            <div class="stat-info">
              <span class="stat-value" id="totalRewardPoints">0‡∏ø</span>
              <span class="stat-label">T·ªïng ƒêi·ªÉm ƒê√£ ƒê·ªïi</span>
            </div>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Icon</th>
                <th>T√™n Ph·∫ßn Th∆∞·ªüng</th>
                <th>M√¥ T·∫£</th>
                <th>ƒêi·ªÉm C·∫ßn</th>
                <th>Lo·∫°i</th>
                <th>Tr·∫°ng Th√°i</th>
                <th>S·ªë L·∫ßn ƒê·ªïi</th>
                <th>H√†nh ƒê·ªông</th>
              </tr>
            </thead>
            <tbody id="rewardsTableBody">
              <tr><td colspan="8" style="text-align: center;">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Exchange History -->
        <div class="tab-header" style="margin-top: 40px;">
          <h3>üìú L·ªãch S·ª≠ ƒê·ªïi Th∆∞·ªüng</h3>
          <div class="search-box">
            <input type="text" id="exchangeSearch" placeholder="üîç T√¨m ki·∫øm..." oninput="searchExchanges(this.value)">
          </div>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Th·ªùi Gian</th>
                <th>H·∫£i T·∫∑c</th>
                <th>Ph·∫ßn Th∆∞·ªüng</th>
                <th>ƒêi·ªÉm ƒê√£ D√πng</th>
                <th>Tr·∫°ng Th√°i</th>
                <th>H√†nh ƒê·ªông</th>
              </tr>
            </thead>
            <tbody id="exchangesTableBody">
              <tr><td colspan="6" style="text-align: center;">Ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·ªïi th∆∞·ªüng</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Weapons Tab -->
      <section id="weapons-tab" class="tab-content" style="display: none;">
        <div class="tab-header">
          <h2>‚öîÔ∏è Qu·∫£n L√Ω V≈© Kh√≠</h2>
          <button class="btn-primary" onclick="openWeaponModal()">‚ûï Th√™m V≈© Kh√≠</button>
        </div>

        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-icon">‚öîÔ∏è</div>
            <div class="stat-info">
              <div class="stat-value" id="totalWeapons">0</div>
              <div class="stat-label">T·ªïng V≈© Kh√≠</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üé≤</div>
            <div class="stat-info">
              <div class="stat-value" id="totalDropped">0</div>
              <div class="stat-label">ƒê√£ R∆°i</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-info">
              <div class="stat-value" id="totalEquipped">0</div>
              <div class="stat-label">ƒêang Trang B·ªã</div>
            </div>
          </div>
        </div>

        <div class="data-table" style="width: 100%;">
          <table style="width: 100%;">
            <thead>
              <tr>
                <th style="width: 80px; text-align: center;">Icon</th>
                <th style="width: 200px;">T√™n V≈© Kh√≠</th>
                <th style="width: 100px;">Lo·∫°i</th>
                <th style="width: 120px;">ƒê·ªô Hi·∫øm</th>
                <th style="min-width: 200px;">Ch·ªâ S·ªë</th>
                <th style="width: 100px; text-align: center;">T·ªâ L·ªá R∆°i</th>
                <th style="width: 120px;">Tr·∫°ng Th√°i</th>
                <th style="width: 120px; text-align: center;">H√†nh ƒê·ªông</th>
              </tr>
            </thead>
            <tbody id="weaponsTableBody">
              <tr><td colspan="8" style="text-align: center;">Ch∆∞a c√≥ v≈© kh√≠ n√†o</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal: Add/Edit Pirate -->
  <div class="modal-overlay" id="pirateModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="pirateModalTitle">‚ûï Th√™m H·∫£i T·∫∑c</h3>
        <button class="close-btn" onclick="closeModal('pirateModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="pirateForm" onsubmit="savePirate(event)">
          <input type="hidden" id="pirateIndex" value="-1">
          <div class="form-group">
            <label>üè¥‚Äç‚ò†Ô∏è T√™n H·∫£i T·∫∑c</label>
            <input type="text" id="pirateName" required placeholder="Nh·∫≠p t√™n h·∫£i t·∫∑c...">
          </div>
          <div class="form-group">
            <label>‚öîÔ∏è BƒÉng Nh√≥m</label>
            <select id="pirateCrew" required>
              <!-- Options will be loaded -->
            </select>
          </div>
          <div class="form-group">
            <label>üí∞ Bounty</label>
            <input type="number" id="pirateBounty" required min="0" placeholder="Nh·∫≠p s·ªë ti·ªÅn truy n√£...">
          </div>
          <div class="form-group">
            <label>üñºÔ∏è Avatar</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <div id="pirateAvatarPreview" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #34495e; display: flex; align-items: center; justify-content: center; background: rgba(52, 73, 94, 0.3); font-size: 32px; overflow: hidden;">
                üì∑
              </div>
              <div style="flex: 1;">
                <label class="btn-upload" style="display: inline-block; padding: 10px 20px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border-radius: 8px; cursor: pointer; margin-bottom: 8px;">
                  üìÅ Ch·ªçn ·∫£nh
                  <input type="file" id="pirateAvatarUpload" accept="image/*" style="display: none;" onchange="previewPirateAvatar(event)">
                </label>
                <input type="text" id="pirateImage" placeholder="Ho·∫∑c nh·∫≠p URL ·∫£nh..." style="width: 100%; padding: 8px; border: 1px solid #34495e; border-radius: 5px; background: rgba(52, 73, 94, 0.3); color: white;">
                <button type="button" onclick="clearPirateAvatar()" style="margin-top: 5px; padding: 5px 15px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">üóëÔ∏è X√≥a ·∫£nh</button>
              </div>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('pirateModal')">H·ªßy</button>
            <button type="submit" class="btn-save">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Add/Edit Crew -->
  <div class="modal-overlay" id="crewModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="crewModalTitle">‚ûï Th√™m BƒÉng Nh√≥m</h3>
        <button class="close-btn" onclick="closeModal('crewModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="crewForm" onsubmit="saveCrew(event)">
          <input type="hidden" id="crewIndex" value="-1">
          <div class="form-group">
            <label>‚öîÔ∏è T√™n BƒÉng Nh√≥m</label>
            <input type="text" id="crewName" required placeholder="Nh·∫≠p t√™n bƒÉng nh√≥m...">
          </div>
          <div class="form-group">
            <label>üé® Icon</label>
            <input type="text" id="crewIcon" required placeholder="Emoji icon (v√≠ d·ª•: üè¥‚Äç‚ò†Ô∏è)">
          </div>
          <div class="form-group">
            <label>üé® M√†u s·∫Øc</label>
            <input type="color" id="crewColor" value="#e74c3c">
          </div>
          <div class="form-group">
            <label>üëë Thuy·ªÅn Tr∆∞·ªüng</label>
            <input type="text" id="crewCaptain" required placeholder="T√™n thuy·ªÅn tr∆∞·ªüng...">
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('crewModal')">H·ªßy</button>
            <button type="submit" class="btn-save">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Add/Edit Rank -->
  <div class="modal-overlay" id="rankModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="rankModalTitle">‚ûï Th√™m C·∫•p ƒê·ªô</h3>
        <button class="close-btn" onclick="closeModal('rankModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="rankForm" onsubmit="saveRank(event)">
          <input type="hidden" id="rankIndex" value="-1">
          <div class="form-group">
            <label>üè∑Ô∏è Type (ID)</label>
            <input type="text" id="rankType" required placeholder="rookie, pirate, supernova...">
          </div>
          <div class="form-group">
            <label>üìõ T√™n Hi·ªÉn Th·ªã</label>
            <input type="text" id="rankName" required placeholder="T√¢n Binh, H·∫£i T·∫∑c...">
          </div>
          <div class="form-group">
            <label>üé® Icon</label>
            <input type="text" id="rankIcon" required placeholder="üë∂, üè¥‚Äç‚ò†Ô∏è, ‚≠ê...">
          </div>
          <div class="form-group">
            <label>üé® M√†u s·∫Øc</label>
            <input type="color" id="rankColor" value="#95a5a6">
          </div>
          <div class="form-group">
            <label>üí∞ Bounty T·ªëi Thi·ªÉu</label>
            <input type="number" id="rankMinBounty" required min="0" placeholder="0, 80, 180...">
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('rankModal')">H·ªßy</button>
            <button type="submit" class="btn-save">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Add/Edit Account -->
  <div class="modal-overlay" id="accountModal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="accountModalTitle">‚ûï Th√™m T√†i Kho·∫£n</h3>
        <button class="close-btn" onclick="closeModal('accountModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="accountForm" onsubmit="saveAccount(event)">
          <input type="hidden" id="accountIndex" value="-1">
          <div class="form-group">
            <label>üë§ Username</label>
            <input type="text" id="accountUsername" required placeholder="Nh·∫≠p username...">
          </div>
          <div class="form-group">
            <label>üìß Email</label>
            <input type="email" id="accountEmail" required placeholder="Nh·∫≠p email...">
          </div>
          <div class="form-group">
            <label>üîí M·∫≠t kh·∫©u</label>
            <input type="password" id="accountPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
          </div>
          <div class="form-group">
            <label>üè¥‚Äç‚ò†Ô∏è H·∫£i T·∫∑c Li√™n K·∫øt</label>
            <select id="accountPirate">
              <option value="">-- Kh√¥ng li√™n k·∫øt --</option>
              <!-- Options will be loaded -->
            </select>
          </div>
          <div class="form-group">
            <label>üëë Vai tr√≤</label>
            <select id="accountRole" required>
              <option value="user">User</option>
              <option value="moderator">Moderator</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label>üìä Tr·∫°ng th√°i</label>
            <select id="accountStatus" required>
              <option value="active">Ho·∫°t ƒë·ªông</option>
              <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
              <option value="banned">B·ªã c·∫•m</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('accountModal')">H·ªßy</button>
            <button type="submit" class="btn-save">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Add/Edit Quest -->
  <div class="modal-overlay" id="questModal">
    <div class="modal modal-lg">
      <div class="modal-header">
        <h3 id="questModalTitle">‚ûï Th√™m Nhi·ªám V·ª•</h3>
        <button class="close-btn" onclick="closeModal('questModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="questForm" onsubmit="saveQuest(event)">
          <input type="hidden" id="questIndex" value="-1">
          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>üìù T√™n Nhi·ªám V·ª•</label>
              <input type="text" id="questTitle" required placeholder="V√≠ d·ª•: Ki·∫øn th·ª©c c∆° b·∫£n v·ªÅ m√°y t√≠nh">
            </div>
            <div class="form-group">
              <label>üéì Kh·ªëi l·ªõp</label>
              <select id="questGrade" required>
                <option value="">-- Ch·ªçn kh·ªëi --</option>
                <option value="3">Kh·ªëi 3</option>
                <option value="4">Kh·ªëi 4</option>
                <option value="5">Kh·ªëi 5</option>
              </select>
            </div>
          </div>
          <div class="form-row" style="display: grid; grid-template-columns: 1fr; gap: 15px;">
            <div class="form-group">
              <label>üìñ M√¥n h·ªçc</label>
              <select id="questSubject" required>
                <option value="">-- Ch·ªçn m√¥n --</option>
                <option value="tin-hoc">Tin h·ªçc</option>
                <option value="cong-nghe">C√¥ng ngh·ªá</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>üìÑ M√¥ t·∫£</label>
            <textarea id="questDescription" rows="2" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ nhi·ªám v·ª•..."></textarea>
          </div>
          
          <!-- Hidden type field -->
          <input type="hidden" id="questType" value="quiz">
          
          <hr style="margin: 20px 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">
          
          <!-- Quiz Type -->
          <div id="quizTypeContainer">
            <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
              <div class="form-group">
                <label>üí∞ ƒêi·ªÉm c·ªông/c√¢u ƒë√∫ng</label>
                <input type="number" id="questRewardPerQuestion" min="1" placeholder="Bounty khi ƒë√∫ng" value="100">
              </div>
              <div class="form-group">
                <label>‚ùå ƒêi·ªÉm tr·ª´/c√¢u sai</label>
                <input type="number" id="questPenaltyPerQuestion" min="0" placeholder="Bounty b·ªã tr·ª´ khi sai" value="50">
              </div>
            </div>
            <div class="form-group">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <label style="margin: 0;">üìö Danh s√°ch C√¢u H·ªèi</label>
                <button type="button" class="add-btn" onclick="addQuestionField()" style="padding: 5px 15px; font-size: 14px;">
                  <span>‚ûï</span> Th√™m C√¢u H·ªèi
                </button>
              </div>
              <div id="questionsContainer">
                <!-- Questions will be added here -->
              </div>
            </div>
          </div>
          
          <!-- Special Type -->
          <div id="specialTypeContainer" style="display: none;">
            <div class="form-group">
              <label>üí∞ ƒêi·ªÉm t·ªëi ƒëa</label>
              <input type="number" id="questMaxScore" min="1" placeholder="ƒêi·ªÉm t·ªëi ƒëa c√≥ th·ªÉ ƒë·∫°t ƒë∆∞·ª£c" value="1000">
            </div>
            <div class="form-group">
              <label>üìã Y√™u c·∫ßu b√†i n·ªôp (kh√¥ng b·∫Øt bu·ªôc)</label>
              <textarea id="questRequirements" rows="4" placeholder="M√¥ t·∫£ y√™u c·∫ßu b√†i n·ªôp c·ªßa h·ªçc sinh...&#10;V√≠ d·ª•: Ch·ª•p ·∫£nh b√†i l√†m tr√™n v·ªü, ho√†n th√†nh b√†i t·∫≠p th·ª±c h√†nh, v.v."></textarea>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('questModal')">H·ªßy</button>
            <button type="submit" class="btn-save">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Review Submission -->
  <div class="modal-overlay" id="reviewSubmissionModal">
    <div class="modal modal-lg">
      <div class="modal-header">
        <h3>üì∏ Duy·ªát B√†i N·ªôp</h3>
        <button class="close-btn" onclick="closeModal('reviewSubmissionModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="reviewSubmissionForm" onsubmit="saveSubmissionReview(event)">
          <input type="hidden" id="submissionId" value="">
          
          <div class="submission-info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; padding: 15px; background: rgba(52, 73, 94, 0.3); border-radius: 10px;">
            <div>
              <strong style="color: #3498db;">üë§ H·ªçc sinh:</strong>
              <span id="submissionStudentName"></span>
            </div>
            <div>
              <strong style="color: #3498db;">‚öîÔ∏è BƒÉng nh√≥m:</strong>
              <span id="submissionCrewName"></span>
            </div>
            <div>
              <strong style="color: #3498db;">üìù Nhi·ªám v·ª•:</strong>
              <span id="submissionQuestTitle"></span>
            </div>
            <div>
              <strong style="color: #3498db;">üìÖ Ng√†y n·ªôp:</strong>
              <span id="submissionDate"></span>
            </div>
          </div>
          
          <div class="form-group">
            <label>üñºÔ∏è H√¨nh ·∫£nh b√†i n·ªôp</label>
            <div id="submissionImagesContainer" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
              <!-- Images will be loaded here -->
            </div>
          </div>
          
          <hr style="margin: 20px 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">
          
          <div class="form-row" style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px;">
            <div class="form-group">
              <label>üìä Tr·∫°ng th√°i</label>
              <select id="submissionStatus" required onchange="toggleScoreField()">
                <option value="pending">‚è≥ Ch·ªù duy·ªát</option>
                <option value="approved">‚úÖ ƒê√£ duy·ªát</option>
                <option value="rejected">‚ùå T·ª´ ch·ªëi</option>
              </select>
            </div>
            <div class="form-group" id="scoreFieldContainer">
              <label>üí∞ ƒêi·ªÉm (Bounty)</label>
              <input type="number" id="submissionScore" min="0" placeholder="Nh·∫≠p ƒëi·ªÉm cho b√†i n·ªôp">
            </div>
          </div>
          
          <div class="form-group">
            <label>üí¨ Nh·∫≠n x√©t</label>
            <textarea id="submissionFeedback" rows="3" placeholder="Nh·∫≠n x√©t c·ªßa gi√°o vi√™n..."></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('reviewSubmissionModal')">ƒê√≥ng</button>
            <button type="submit" class="btn-save">L∆∞u ƒë√°nh gi√°</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h3>‚ö†Ô∏è X√°c nh·∫≠n</h3>
        <button class="close-btn" onclick="closeModal('confirmModal')">&times;</button>
      </div>
      <div class="modal-body">
        <p id="confirmMessage">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('confirmModal')">H·ªßy</button>
          <button type="button" class="btn-danger" id="confirmBtn">X√°c nh·∫≠n</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Reward Modal -->
  <div id="rewardModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 id="rewardModalTitle">‚ûï Th√™m Ph·∫ßn Th∆∞·ªüng</h2>
        <button class="close-btn" onclick="closeModal('rewardModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="rewardForm" onsubmit="saveReward(event)">
          <input type="hidden" id="rewardId">
          
          <div class="form-group">
            <label>üéØ T√™n Ph·∫ßn Th∆∞·ªüng</label>
            <input type="text" id="rewardName" required placeholder="V√≠ d·ª•: Devil Fruit, Wanted Poster...">
          </div>

          <div class="form-group">
            <label>üìù M√¥ T·∫£</label>
            <textarea id="rewardDescription" rows="3" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ ph·∫ßn th∆∞·ªüng..."></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>üí∞ ƒêi·ªÉm C·∫ßn (Bounty)</label>
              <input type="number" id="rewardPoints" required min="1" placeholder="1000">
            </div>
            <div class="form-group">
              <label>üòÄ Icon/Emoji</label>
              <input type="text" id="rewardIcon" placeholder="üéÅ" maxlength="10">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>üè∑Ô∏è Lo·∫°i</label>
              <select id="rewardType">
                <option value="normal">Th∆∞·ªùng</option>
                <option value="rare">Hi·∫øm</option>
                <option value="epic">S·ª≠ Thi</option>
                <option value="legendary">Huy·ªÅn Tho·∫°i</option>
                <option value="secret">B√≠ M·∫≠t</option>
              </select>
            </div>
            <div class="form-group">
              <label>üìä Tr·∫°ng Th√°i</label>
              <select id="rewardStatus">
                <option value="active">K√≠ch Ho·∫°t</option>
                <option value="inactive">T·∫°m Ng∆∞ng</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="rewardLimited" onchange="toggleLimitInput()">
              Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng
            </label>
            <input type="number" id="rewardLimit" min="1" placeholder="S·ªë l∆∞·ª£ng t·ªëi ƒëa" style="margin-top: 8px; display: none;">
          </div>

          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('rewardModal')">H·ªßy</button>
            <button type="submit" class="btn-save">üíæ L∆∞u</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Add/Edit Weapon -->
  <div id="weaponModal" class="modal-overlay">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h2 id="weaponModalTitle">‚öîÔ∏è Th√™m V≈© Kh√≠</h2>
        <button class="close-btn" onclick="closeModal('weaponModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="weaponForm" onsubmit="saveWeapon(event)">
          <input type="hidden" id="weaponId">
          
          <div class="form-row">
            <div class="form-group">
              <label>Icon V≈© Kh√≠ <span class="required">*</span></label>
              <input type="text" id="weaponIcon" placeholder="‚öîÔ∏è" maxlength="2" required>
              <small>Nh·∫≠p emoji (‚öîÔ∏è üó°Ô∏è üèπ ‚ö° üî•)</small>
            </div>
            
            <div class="form-group">
              <label>T√™n V≈© Kh√≠ <span class="required">*</span></label>
              <input type="text" id="weaponName" placeholder="Ki·∫øm Demon" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Lo·∫°i <span class="required">*</span></label>
              <select id="weaponType" required>
                <option value="">-- Ch·ªçn Lo·∫°i --</option>
                <option value="sword">‚öîÔ∏è Ki·∫øm (Sword)</option>
                <option value="gun">üî´ S√∫ng (Gun)</option>
                <option value="bow">üèπ Cung (Bow)</option>
                <option value="staff">üîÆ G·∫≠y (Staff)</option>
                <option value="hammer">üî® B√∫a (Hammer)</option>
                <option value="spear">üó°Ô∏è Th∆∞∆°ng (Spear)</option>
                <option value="axe">ü™ì R√¨u (Axe)</option>
              </select>
            </div>

            <div class="form-group">
              <label>ƒê·ªô Hi·∫øm <span class="required">*</span></label>
              <select id="weaponRarity" required>
                <option value="">-- Ch·ªçn ƒê·ªô Hi·∫øm --</option>
                <option value="common">‚ö™ Common (Th∆∞·ªùng)</option>
                <option value="uncommon">üü¢ Uncommon (Kh√°)</option>
                <option value="rare">üîµ Rare (Hi·∫øm)</option>
                <option value="epic">üü£ Epic (S·ª≠ Thi)</option>
                <option value="legendary">üü° Legendary (Huy·ªÅn Tho·∫°i)</option>
                <option value="mythic">üî¥ Mythic (Th·∫ßn Tho·∫°i)</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>M√¥ T·∫£</label>
            <textarea id="weaponDescription" rows="2" placeholder="Thanh ki·∫øm huy·ªÅn tho·∫°i v·ªõi s·ª©c m·∫°nh kh·ªßng khi·∫øp..."></textarea>
          </div>

          <hr style="margin: 20px 0; border-color: rgba(243, 156, 18, 0.3);">
          <h4 style="color: #f39c12; margin-bottom: 15px;">üìä Ch·ªâ S·ªë Stats</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label>üí™ ATK (T·∫•n C√¥ng %)</label>
              <input type="number" id="weaponATK" value="0" min="0">
            </div>
            
            <div class="form-group">
              <label>üõ°Ô∏è DEF (Ph√≤ng Th·ªß)</label>
              <input type="number" id="weaponDEF" value="0" min="0">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>‚ù§Ô∏è HP (M√°u)</label>
              <input type="number" id="weaponHP" value="0" min="0">
            </div>
            
            <div class="form-group">
              <label>‚ö° Crit Rate (%)</label>
              <input type="number" id="weaponCrit" value="0" min="0" max="100" step="0.1">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>üé≤ T·ªâ L·ªá R∆°i (%) <span class="required">*</span></label>
              <input type="number" id="weaponDropRate" value="10" min="0.1" max="100" step="0.1" required>
              <small>C√†ng cao c√†ng d·ªÖ r∆°i (Common: 40-50%, Legendary: 1-5%)</small>
            </div>

            <div class="form-group">
              <label>Tr·∫°ng Th√°i</label>
              <select id="weaponStatus">
                <option value="active">‚úÖ K√≠ch Ho·∫°t</option>
                <option value="inactive">‚ùå T·∫°m D·ª´ng</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeModal('weaponModal')">H·ªßy</button>
            <button type="submit" class="btn-save">üíæ L∆∞u V≈© Kh√≠</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/utils.js"></script>
  <script>
    // Firebase ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o b·ªüi firebase-config.js
    if (!database) {
      console.error('Database ch∆∞a kh·ªüi t·∫°o');
    }
  </script>
  <script src="js/admin.js"></script>
</body>
</html>
